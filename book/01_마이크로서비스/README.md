# Chapter 1. 마이크로서비스

## 1.1 마이크로서비스란

마이크로서비스란 작고 자율적으로 협업하는 서비스를 의미한다.

### 1.1.1 작고, 한 가지 일을 잘하는데 주력

모놀리식 시스템에서 우리는 코드를 더 응집하고, 추상화 또는 모듈화하면서 앞에서 언급한 위협에 대항한다. 

> **단일 책임 원칙**
>
> 같은 이유로 변경되는 것들은 한데 모으고, 서로 다른 이유로 변경되는 것들은 분리하라

마이크로서비스는 독립적인 서비스에 대해 동일한 접근 방식을 취한다.

- 마이크로서비스란 2주 안에 재작성될 수 있는 것
- 마이크로서비스란 충분히 작아서 더 이상 작아질 수 없는 크기
  - 얼마나 작은지는 서비스가 팀 구조와 서로 얼마나 적절하게 배치되어 있는지와 연관되어 있다.

서비스가 작아질수록 마이크로서비스 아키텍처의 혜택과 단점은 더 극대화되며, 서비스를 더 작게 만들수록 상호의존성에 대한 문제는 줄어든다



### 1.1.2 자율성

마이크로서비스는 분리된 개체다. PaaS(platform as a service) 상의 격리된 서비스거나 운영체제 상의 프로세스가 될 수 있다.

이런 격리가 약간의 부담을 주더라도 결과적으로 얻어지는 단순화를 통해 분산 시스템을 더 쉽게 추론할 수 있고 더 새로운 기술들을 통해 이러한 배포 형태와 관련한 많은 어려움을 극복할 수 있다.

서비스 사이의 모든 통신은 네트워크 호출을 통해 이루어진다. 이 서비스들은 서로 독립적으로 변경될 수 있어야 하고, 소비자를 변경할 필요 없이 독립적으로 배포될 수 있어야 한다.

이 때, 서비스가 무엇을 외부에 드러내고 내부에 두어야하는지 고민해야 한다.

우리는 API를 통해 상호 협업하는 서비스들과 통신한다. 따라서 기술중립적인 API를 선택하여 다양한 기술을 선택할 수 있도록 해야 한다.



## 1.2 주요 혜택

분산 시스템과 서비스 지향 아키텍처

### 1.2.1 기술 이기종성

다수의 협업 서비스로 구성된 시스템에서는 각 서비스가 다른 기술을 사용하도록 결정할 수 있다.

만능보다는 각 작업에 적합한 도구를 선택하게 해준다.

따라서 새로운 기술 분야를 시험해보고 싶을 때 리스크가 가장 낮은 서비스를 선택해서 그곳에 새로운 기술을 사용해볼 수 있다.

다른 기술들의 병행 사용에 우려되는 또 다른 요소는 서비스의 크기인데, 만약 실제로 2주안에 재작성 가능한 코드베이스라면 새로운 기술 적용에 따른 리스크를 완화할 수 있을 것이다.



### 1.2.2 회복성

회복 공학의 핵심 개념은 격벽이다

- 한 시스템의 컴포넌트에 장애가 발생하더라도 장애가 전파되지 않는다면 해당 문제를 격리하고 나머지 시스템을 계속 작동시킬 수 있다.

- 주의점
  - 마이크로서비스 시스템이 향상된 회복력을 적절히 수용할 수 있도록 분산 시스템이 마주한 새로운 장애 요인들을 이해해야 한다.



### 1.2.3 확장성

작은 서비스들로 구성되어있다면 필요한 서비스만 확장할 수 있다.

AWS에서 제공하는 것과 같은 주문형 프로비저닝 시스템을 도입하면 필요한 곳에 이 주문형 확장 기술을 적용할 수 있다(ex. 길트)



### 1.2.4 배포 용이성

모놀리식 아키텍처에서는 수차례의 릴리즈에 걸친 수많은 변경사항이 한꺼번에 반영된 버전의 애플리케이션이 운영 환경에 배포되게 된다.

마이크로서비스를 이용하면 하나의 서비스만 변경할 수 있으며, 나머지 시스템과 독립적으로 배포할 수 있다.

코드를 신속하게 배포할 수 있고 문제가 발생하더라도 개별 서비스만 롤백하여 해당 문제를 격리할 수 있다.



### 1.2.5 조직 부합성

아키텍처를 조직 구조에 맞게 더 적절히 정렬할 수 있고, 최적의 팀 크기와 생산성을 위해 하나의 코드베이스에서 일하는 인원을 최소화할 수 있다.

또한, 같은 곳에 있는 서비스 소유권을 팀 간에 이전할 수도 있다



### 1.2.6 조합성

분산 시스템과 서비스 지향 아키텍처의 주요 장점 중 하나는 기능을 재사용할 기회가 많다는 것이다.

조직이 고객과의 좁은 채널에서 벗어나 고객이 직접 참여하는 더 포괄적인 개념을 고려하게 된 만큼 이를 지원할 수 있는 아키텍처가 필요하다



### 1.2.7 대체 가능성을 위한 최적화

마이크로서비스 방식을 사용하는 팀은 필요할 경우 서비스를 완전히 재작성하는 것을 편하게 생각하며, 서비스가 더 이상 필요치 않으면 쉽게 제거할 수 있다.



## 1.3 서비스 지향 아키텍처

서비스 지향 아키텍처란 서비스의 최종 능력 집합을 제공하는 여러 서비스가 서로 협업하도록 하는 설계 접근 방식이다. 
(여기서 서비스란 일반적으로 완전히 분리된 운영시스템의 프로세스를 의미한다. 서비스간 통신은 네트워크 호출로 이루어진다.)



SOA는 소프트웨어 재사용성 장려를 목표로한다. 둘 이상의 사용자 애플리케이션이 서로 같은 서비스를 사용할 수 있다.

하지만 SOA 관련 문제는 통신 프로토콜, 벤더 미들웨어, 서비스 세분화에 대한 지침 부족, 분리할 시스템 선정에 대한 잘못된 지침과 같은 것이 있다.

-> 이런 문제들은 추후 다루겠다



실사용을 기반으로 출현한 마이크로서비스는 SOA에 적합한 시스템과 아키텍처를 더 잘 이해할 수 있게 해준다. 따라서 마이크로서비스는 SOA에 대한 특정 접근법으로 보아야 한다.



## 1.4 기타 분해 기술

### 1.4.1 공유 라이브러리

라이브러리는 서드파티에서 제공하거나 내부 조직에서 만들 수 있다.

[라이브러리를 사용했을 때 장단점]

- 장점

  - 팀과 서비스간에 기능 공유
  - 재사용

- 단점

  - 기술 이기종성을 잃게 됨 (라이브러리는 동일한 언어로 구현되거나 최소한 동일 플랫폼에서 실행되기 때문)
  - 시스템 일부를 독립적으로 확장하기 어려워진다
  - 동적 라이브러리를 사용하지 않는 한 전체 프로세스를 재배포하지 않고서는 새로운 라이브러리를 배포할 수 없으므로 변경 부분만 격리하여 배포할 수 있는 능력이 떨어진다.
  - 시스템 회복력을 보장하는 구조적 안전 조치를 취할 접합부가 부족하다

  

### 1.4.2 모듈

- 독자적인 모듈 분해 기술을 제공한다. 이러한 언어는 모듈의 수명주기 관리 기능을 일부 제공한다.
- OSGI(Open Source Gateway Initiative)는 모듈 분해를 실제로 구현해낸 대표적인 예이다.
  - 문제는 언어 자체의 충분한 지원 없이 모듈 수명주기 관리를 강제하려 한다는 점이다. 
  - 이는 모듈 작성자가 모듈의 적절한 독립성을 위해 더 많은 일을 해야하는 결과를 초래했다.
  - 또한 하나의 프로세스 경계 안에서 모듈이 서로 과도하게 결합하는 함정에 빠지기 쉽다.
- 얼랭은 모듈이 언어 런타임으로 생성된다.
  - 얼랭은 모듈을 우아하게 업그레이드함으로써 정해진 시간 내에 여러 버전의 모듈을 실행하는 것을 지원한다
- 하나의 모놀리식 어플리케이션 내에서도 구조화가 잘 이루어진 독립형 모듈을 생성할 수 있어야 하지만 실제로는 그러한 사례를 찾아보기 어렵다.
- 한 프로세스 안의 여러 모듈을 각각 서비스로 분해하더라도 그것이 모든 문제를 해결하지는 않는다.

## 1.5 은총알은 없다

마이크로서비스가 은총알은 아니다. 

